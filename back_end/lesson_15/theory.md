
___________________________________________________________________

# Теория и план действий

## 01. Подключение базы данных

Удаляем старый репозиторий:
1. Удаляем users.txt 
2. Удаляем в application.properties `users.file-name`
3. В repositories удаляем `UsersRepositoryFileImpl`

## 02.H2 база данных

* H2 - это минимальная СУБД, как правило, используется только для тестирования
* Аналог MySQL, PostgreSQL, OracleDB
* Данные может хранить:
  * в оперативной памяти
  * в файле

## 03. Подключение базы данных в Spring Boot приложении

* Подключить зависимости в `pom.xml`:

```xml

<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <version>2.2.222</version>
    <scope>runtime</scope>
</dependency>

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
```

* Достаточно указать настройки в `application.properties`
* Spring Boot умеет сам подключаться по этим настройкам к базе
* Если мы хотим хранить данные в оперативной памяти (т.е. база будет очищаться после перезапуска приложения), то указываем в свойствах:

```
spring.datasource.url=jdbc:h2:mem:test_db
```

* `jdbc` - протокол подключения к базам данных в Java
* `h2` - тип базы данных
* `mem` - показывает, что база будет размещаться в оперативной памяти
* `shop_db` - название базы данных

* Если мы хотим хранить данные в файле, то нужно указать URL таким образом:

```
jdbc:h2:file:~/databases/test_db;AUTO_SERVER=TRUE
```

* `file` - храним данные в файле
* `~/databases` - название папки, где мы храним данные (в папке пользователя в подпапке `databases`)
* `test_db` - название базы
* `AUTO_SERVER=TRUE` - чтобы можно было подключаться из других приложений

## 04. Дополнительные классы и интерфейсы

* `DataSource` - объект, который содержит подключение к базе данных, описанной в `application.properties`
* 'JdbcTemplate' - класс, который предоставляет удобный способ взаимодействия с базой данных с использованием JDBC (Java Database Connectivity). JDBC является стандартным интерфейсом для взаимодействия с реляционными базами данных из Java-приложений.

## 05. План работы

* Вместо работы с обычным файлом, мы подключим СУБД H2, которая умеет хранить данные в памяти и в файле.

* План действий по H2:
    * Добавить зависимости на `h2` и `spring-boot-data-jpa` в pom.xml
    * Заполнить файл `application.properties`
    * Создать папку `databases`, в которой будет лежать база данных
    * После запуска приложения, проверить, что наша БД появилась в папке `databases`
    * Подключиться к базе данных через IDEA
    * Запустить консоль базы и отправлять через нее SQL-запросы
    * Просматривать содержимое таблиц
    * Если какие-то обновления не видны, необходимо нажать на две круглые стрелочки (перечитать содержимое, обновить)
  
* Следующие задачи:
    - переписать репозиторий UserRepository для работы с БД
    - переписать контроллер UserController для работы со всеми необходимыми endpoints
    - реализовать необходимые методы:
      - создание(добавление) пользователя
      - получение одного конкретного и всех пользователей
      - обновление пользователя
      - удаление пользователя
